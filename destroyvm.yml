- name: Stop virtual machine
  command: virsh destroy "{{ inventory_hostname }}"
  register: commandresult
  ignore_errors: True
  when: force_create == "true"
  tags: removevm

- name: Undefine virtual machine
  virt_guest: guest={{ inventory_hostname }} state=absent
  when: force_create == "true"
  tags: removevm

- name: Undefine virtual machine
  file:
    path:  "/y/vm/{{ inventory_hostname }}.qcow2"
    state: absent
  when: force_create == "true"
  tags: removevm
